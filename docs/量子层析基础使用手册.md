# 1. 背景知识

量子态层析指的是通过一系列量子测量获得数据后估计出未知系统的密度矩阵的过程。量子过程层析指的是利用多种不同的量子态输入某一未知量子过程，如量子通道或量子门，与之相互作用后测量输出的量子态再由输入输出之间的关系来估计出该量子过程。

量子态层析和量子过程层析统称为量子层析技术。量子层析可分为两个过程:**量子测量**以及**重构算法**，从这两个过程出发可以设计不同的方案，它们也有着各自不同的优缺点。

量子层析主要关心两个指标:**估计精度**和**复杂度**。高精度的量子层析是量子计算和其他量子技术的必要条件，而且量子资源的稀缺性迫使我们寻找更有效的降低估计误差的方法。量子层析的复杂度问题源于量子系统的维度随着比特数指数增长，这使得实验测量过程和算法重构过程都变得极其复杂。

## 1.1密度矩阵(4维)

### 1.1.1 定义态矢量

我们用$|l, p\rangle$表示量子态，其中$l$为角向量子数，$p$为径向量子数。

编码定义如下：

$$
\begin{aligned}
|0\rangle &= |1, 0\rangle \\
|1\rangle &= |-1, 0\rangle \\
|2\rangle &= |1, 1\rangle \\
|3\rangle &= |-1, 1\rangle
\end{aligned}
$$

一个任意的量子态\(|\psi\rangle\)可以表示为：

$$
|\psi\rangle = c_0 e^{i\phi_0} |0\rangle + c_1 e^{i\phi_1} |1\rangle + c_2 e^{i\phi_2} |2\rangle + c_3 e^{i\phi_3} |3\rangle
$$

态矢量的密度矩阵定义为：

$$
\rho = |\psi\rangle \langle \psi|
$$

计算密度矩阵 $\rho$ 的各个矩阵元：

$$
\rho = \begin{pmatrix}
c_0 e^{i\phi_0} \\
c_1 e^{i\phi_1} \\
c_2 e^{i\phi_2} \\
c_3 e^{i\phi_3}
\end{pmatrix}
\begin{pmatrix}
c_0 e^{-i\phi_0} & c_1 e^{-i\phi_1} & c_2 e^{-i\phi_2} & c_3 e^{-i\phi_3}
\end{pmatrix}
$$

结果是一个 $4 \times 4$ 矩阵：

$$
\rho = \begin{pmatrix}
c_0^2 & c_0 c_1 e^{i(\phi_0 - \phi_1)} & c_0 c_2 e^{i(\phi_0 - \phi_2)} & c_0 c_3 e^{i(\phi_0 - \phi_3)} \\
c_0 c_1 e^{-i(\phi_0 - \phi_1)} & c_1^2 & c_1 c_2 e^{i(\phi_1 - \phi_2)} & c_1 c_3 e^{i(\phi_1 - \phi_3)} \\
c_0 c_2 e^{-i(\phi_0 - \phi_2)} & c_1 c_2 e^{-i(\phi_1 - \phi_2)} & c_2^2 & c_2 c_3 e^{i(\phi_2 - \phi_3)} \\
c_0 c_3 e^{-i(\phi_0 - \phi_3)} & c_1 c_3 e^{-i(\phi_1 - \phi_3)} & c_2 c_3 e^{-i(\phi_2 - \phi_3)} & c_3^2
\end{pmatrix}
$$
一个 \(4 \times 4\) 的密度矩阵 \(\rho\) 表示为：$A_{ij}=c_i*c_j^*$，$\phi_{ij}=\phi_i-\phi_j$
$$
\rho = \begin{pmatrix}
A_{00} & A_{01}e^{i\phi_{01}} & A_{02}e^{i\phi_{02}} & A_{03}e^{i\phi_{03}} \\
A_{01}e^{-i\phi_{01}} & A_{11} & A_{12}e^{i\phi_{12}} & A_{13}e^{i\phi_{13}} \\
A_{02}e^{-i\phi_{02}} & A_{12}e^{-i\phi_{12}} & A_{22} & A_{23}e^{i\phi_{23}} \\
A_{03}e^{-i\phi_{03}} & A_{13}e^{-i\phi_{13}} & A_{23}e^{-i\phi_{23}} & A_{33}
\end{pmatrix}
$$

各个矩阵元的关系可以总结如下：

- 对角元：
  $$
  \rho_{ii} = c_i^2
  $$

- 非对角元：
  $$
  \rho_{ij} = c_i c_j^* e^{i(\phi_i - \phi_j)}, \quad i \neq j
  $$

因此，密度矩阵 $\rho$ 的元素由系数 $c_i$ 和相位 $\phi_i$ 确定。

### 1.1.2 真实密度矩阵需要满足的物理条件

1. **正定性（positivity）**：所有特征值非负，确保物理可行性。密度矩阵的特征值可以通过求解以下特征方程得到：
   $$
   \text{det}(\rho - \lambda I) = 0
   $$
   
   其中，\(\lambda\) 是特征值，\(I\) 是单位矩阵。密度矩阵 $\rho$ 的所有特征值 $\lambda_i$都必须满足以下条件：
   
   $$
   \lambda_i \geq 0
   $$
   也可写成
   
   $$
   0 \leq \mathrm{Tr}\{\hat{\rho}^2\} \leq 1
   $$
   
2. **规范性（normalization）**：表示概率归一化。
   $$
   \text{Tr}(\hat{\rho}) = 1
   $$
   
3. **厄米性（hermiticity）**：

   $$
   \hat{\rho}^\dagger = \hat{\rho}
   $$

   即

   $$
   \rho_{ij} = \rho_{ji}^*
   $$

通过这些物理条件，可以确保密度矩阵描述的量子状态是物理上可行的。

## 1.2 确定各投影基矢/算符

定义投影基矢$|i\rangle$和对应的投影算符$\mu_i,i=1,2,...16$：

1. **间隔0**
   $$
   \begin{aligned}
   |0\rangle &= |1, 0\rangle \implies \mu_1 = |0\rangle\langle 0| \\
   |1\rangle &= |-1, 0\rangle \implies \mu_2 = |1\rangle\langle 1| \\
   |2\rangle &= |1, 1\rangle \implies \mu_3 = |2\rangle\langle 2| \\
   |3\rangle &= |-1, 1\rangle \implies \mu_4 = |3\rangle\langle 3|
   \end{aligned}
   $$
   
2. **间隔1**

   $$
   \begin{aligned}
   |0,1\rangle &= \frac{1}{\sqrt{2}}(|0\rangle + |1\rangle) \implies \mu_5 = |0,1\rangle\langle 0,1| \\
   |0,-1\rangle &= \frac{1}{\sqrt{2}}(|0\rangle - i|1\rangle) \implies \mu_6 = |0,-1\rangle\langle 0,-1| \\
   |1,2\rangle &= \frac{1}{\sqrt{2}}(|1\rangle + |2\rangle) \implies \mu_7 = |1,2\rangle\langle 1,2| \\
   |1,-2\rangle &= \frac{1}{\sqrt{2}}(|1\rangle - i|2\rangle) \implies \mu_8 = |1,-2\rangle\langle 1,-2| \\
   |2,3\rangle &= \frac{1}{\sqrt{2}}(|2\rangle + |3\rangle) \implies \mu_9 = |2,3\rangle\langle 2,3| \\
   |2,-3\rangle &= \frac{1}{\sqrt{2}}(|2\rangle - i|3\rangle) \implies \mu_{10} = |2,-3\rangle\langle 2,-3|
   \end{aligned}
   $$

3. **间隔2**

   $$
   \begin{aligned}
   |0,2\rangle &= \frac{1}{\sqrt{2}}(|0\rangle + |2\rangle) \implies \mu_{11} = |0,2\rangle\langle 0,2| \\
   |0,-2\rangle &= \frac{1}{\sqrt{2}}(|0\rangle - i|2\rangle) \implies \mu_{12} = |0,-2\rangle\langle 0,-2| \\
   |1,3\rangle &= \frac{1}{\sqrt{2}}(|1\rangle + |3\rangle) \implies \mu_{13} = |1,3\rangle\langle 1,3| \\
   |1,-3\rangle &= \frac{1}{\sqrt{2}}(|1\rangle - i|3\rangle) \implies \mu_{14} = |1,-3\rangle\langle 1,-3|
   \end{aligned}
   $$

4. **间隔3**

   $$
   \begin{aligned}
   |0,3\rangle &= \frac{1}{\sqrt{2}}(|0\rangle + |3\rangle) \implies \mu_{15} = |0,3\rangle\langle 0,3| \\
   |0,-3\rangle &= \frac{1}{\sqrt{2}}(|0\rangle - i|3\rangle) \implies \mu_{16} = |0,-3\rangle\langle 0,-3|
   \end{aligned}
   $$

## 1.3 在不同投影基下的测量值

对于每个投影算符 \($\mu_i$\)，通过测量得到的功率 \($P_i$\) 可以表示为：

$$
P_i = N\text{Tr}(\rho \mu_i)
$$

$N$为比例系数

在量子态层析中，通过一系列投影算符 \($\mu_i$\) 测量系统的状态。这些投影算符对应于系统在不同基矢上的投影。我们需要测量在每个投影算符下的强度分布 \($P_i$\)。例如，如果有16个投影算符，我们需要进行16次不同的测量，每次测量都得到一个强度值(与概率值对应)。

# 2.重构密度矩阵

## 2.1. 线性方程组解法[^1]

为了从测量概率中重构密度矩阵 \($\rho$\)，我们需要将问题表示为一个线性方程组。关键在于构建矩阵 \(M\)，其中每一行对应一个投影算符的矩阵展开形式。

### 2.1.1 投影算符的矩阵表示

每个投影算符 \($\mu_i$\) 是一个 \($4 \times 4$\) 的矩阵。我们需要将这些矩阵展平为向量。例如，对于投影算符 \($\mu_1 = |0\rangle \langle 0|$\)，其矩阵形式是：

$$
\mu_1 = \begin{pmatrix}
1 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0
\end{pmatrix}
$$

展平为向量后是：

$$
\text{vec}(\mu_1) = [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
$$

### 2.1.2 构建矩阵 \(M\)

我们将所有投影算符展平后的向量排列成矩阵的行。假设 $\mu_i$展平后的向量表示为 $\text{vec}(\mu_i)$，那么矩阵 \(M\) 的第 \(i\) 行就是 \($\text{vec}(\mu_i)$\)。

对于所有16个投影算符，我们得到一个 \($16 \times 16$\) 的矩阵 \(M\)。

$$
M = \begin{pmatrix}
\text{vec}(\mu_1) \\
\text{vec}(\mu_2) \\
\vdots \\
\text{vec}(\mu_{16})
\end{pmatrix}
$$



### 2.1.3 线性方程组

有了矩阵 $M$和测量概率向量 $P$之后，我们可以将密度矩阵 $\rho$的展开表示为向量 $\vec{\rho}$，并建立线性方程组：


$$
M = \begin{pmatrix}
\text{vec}(\mu_1) \\
\text{vec}(\mu_2) \\
\vdots \\
\text{vec}(\mu_{16})
\end{pmatrix}, \quad \vec{P} = \begin{pmatrix}
P_1 \\
P_2 \\
\vdots \\
P_{16}
\end{pmatrix}/\sum^4_1(P_i)
$$

线性方程组表示为：

$$
\vec{P} = M \vec{\rho}
$$

通过求解上述线性方程组，可以得到密度矩阵 \($\rho$\) 的展开向量 \($\vec{\rho}$\)，然后将其重构为 \($4 \times 4$​\) 的密度矩阵。

### 2.1.4 缺陷及处理方法

线性方程组求解密度矩阵的方法缺陷在于重构得出的最终密度矩阵可能是非物理的，即不能满足1.1.2中的所有要求。此时，需要一些特殊的处理将非物理密度矩阵转变为物理的密度矩阵。下面是对这一过程的一种常用方法的详细描述。

为了确保重构的密度矩阵是物理上可行的，我们需要进行以下步骤：

1. **特征值分解**：首先，计算密度矩阵 $\rho$ 的特征值分解。特征值分解可以将密度矩阵表示为特征向量矩阵 $v$ 和对角矩阵 $d$ 的乘积：
   $$
   \rho = v d v^{-1}
   $$
   其中，$v$ 是特征向量矩阵，$d$ 是包含特征值的对角矩阵。

2. **删除负特征值**：为了确保密度矩阵的正定性，我们需要将 $d$ 中所有负特征值设为零：
   $$d_{ij} = \begin{cases}
   d_{ij} & \text{if } d_{ij} \geq 0 \\
   0 & \text{if } d_{ij} < 0
   \end{cases}$$
   这一操作确保了特征值矩阵中的所有元素非负。

3. **归一化特征值矩阵**：接下来，我们需要将特征值矩阵 $d$ 进行归一化，使其迹为1：
   $$
   d = \frac{d}{\text{Tr}(d)}
   $$
   归一化确保了密度矩阵的规范性，即 $\text{Tr}(\rho) = 1$。

4. **重构密度矩阵**：使用特征向量矩阵 $v$ 和处理后的特征值矩阵 $d$ 重新构造密度矩阵：
   $$
   \rho = v d v^{-1}
   $$
   这一步骤将处理后的特征值重新组合成新的密度矩阵。

5. **确保 Hermitian 性和数值稳定性**：为了确保密度矩阵的 Hermitian 性和数值稳定性，我们进行以下操作：
   $$
   \rho = \text{tril}(\rho, -1) + \text{tril}(\rho, -1)^\dagger + \text{real}(\text{diag}(\text{diag}(\rho))) + \epsilon I
   $$
   其中，$\text{tril}(\rho, -1)$ 提取 $\rho$ 的下三角部分（不包括对角线），$\text{tril}(\rho, -1)^\dagger$ 是其共轭转置，$\text{real}(\text{diag}(\text{diag}(\rho)))$ 确保对角元素为实数，$\epsilon I$ 是对角线上加入的一个非常小的数，确保数值稳定性。

通过上述步骤，我们可以将一个可能非物理的密度矩阵转化为一个物理上有效的密度矩阵。

### 2.4.4 MATLAB代码示例

下面是一个详细的 MATLAB 代码示例，演示从测量概率中重构密度矩阵的过程：

#### 1.主函数

```
P4 = [50, 50, 40, 40, 100, 40, 90, 35, 80, 30, 90, 35, 90, 35, 90,35];%理想
% P4 = [52, 47, 34, 34, 76, 48, 75, 47, 52, 23, 88, 26, 81, 32, 78, 21];%7.16
% P4 = [56, 57, 37, 37, 86, 43, 80, 43, 62, 28, 82, 34, 95, 45, 74,37];%7.17
%归一化
    P4d = P4 / sum(P4(1:4));
% 初步线性重构
    rho_first_4d = reconstruct_density_matrix_4D(P4d);
```

#### 2.子函数:求解方程组

```
function rho_r = reconstruct_density_matrix_4D(P4d)
xx=0;
%输入功率值
% P_raw = 250.*[0.1; 0.15; 0.2; 0.05; 0.05; 0.05; 0.1; 0.05; 0.05; 0.05; 0.05; 0.05; 0.05; 0.05; 0.05; 0.05];
p= P4d;
P_raw=p';
% 对测量功率值进行归一化
P = P_raw / sum(P_raw(1:4));

% 定义投影算符
[~, mu] = define_operators();


% 构建线性方程组
M = zeros(16, 16);
for j = 1:16
    mu_j = mu{j};
    M(j, :) = reshape(mu_j, 1, []);
end

% 求解密度矩阵的元素
rho_vector = M \ P;

% 将向量形式的密度矩阵转换为 4x4 矩阵
rho_matrix = reshape(rho_vector, 4, 4);

 % 根据xx值决定使用何种方法确保密度矩阵满足物理条件，如 Hermitian 和正定性
if xx==1
    rho_matrix = (rho_matrix + rho_matrix') / 2;
    rho_matrix = rho_matrix / trace(rho_matrix);
else if xx==0
    rho_matrix = makephysical(rho_matrix);
else
    error('wrong xx.');
    end
end

rho_r = rho_matrix;
% 输出重构的密度矩阵
disp('初步重构的密度矩阵：');
disp(rho_r);
```

#### 3.子函数:定义投影算符

```matlab
function [ket, mu] = define_operators()
    % 定义基态
    ket{1} = [1; 0; 0; 0];
    ket{2} = [0; 1; 0; 0];
    ket{3} = [0; 0; 1; 0];
    ket{4} = [0; 0; 0; 1];

    % 定义投影算符
    mu = cell(16, 1);
    mu{1} = ket{1} * ket{1}';
    mu{2} = ket{2} * ket{2}';
    mu{3} = ket{3} * ket{3}';
    mu{4} = ket{4} * ket{4}';
    mu{5} = (1/sqrt(2)) * (ket{1} + ket{2}) * (1/sqrt(2)) * (ket{1}' + ket{2}');
    mu{6} = (1/sqrt(2)) * (ket{1} - 1i*ket{2}) * (1/sqrt(2)) * (ket{1}' + 1i*ket{2}');
    mu{7} = (1/sqrt(2)) * (ket{2} + ket{3}) * (1/sqrt(2)) * (ket{2}' + ket{3}');
    mu{8} = (1/sqrt(2)) * (ket{2} - 1i*ket{3}) * (1/sqrt(2)) * (ket{2}' + 1i*ket{3}');
    mu{9} = (1/sqrt(2)) * (ket{3} + ket{4}) * (1/sqrt(2)) * (ket{3}' + ket{4}');
    mu{10} = (1/sqrt(2)) * (ket{3} - 1i*ket{4}) * (1/sqrt(2)) * (ket{3}' + 1i*ket{4}');
    mu{11} = (1/sqrt(2)) * (ket{1} + ket{3}) * (1/sqrt(2)) * (ket{1}' + ket{3}');
    mu{12} = (1/sqrt(2)) * (ket{1} - 1i*ket{3}) * (1/sqrt(2)) * (ket{1}' + 1i*ket{3}');
    mu{13} = (1/sqrt(2)) * (ket{2} + ket{4}) * (1/sqrt(2)) * (ket{2}' + ket{4}');
    mu{14} = (1/sqrt(2)) * (ket{2} - 1i*ket{4}) * (1/sqrt(2)) * (ket{2}' + 1i*ket{4}');
    mu{15} = (1/sqrt(2)) * (ket{1} + ket{4}) * (1/sqrt(2)) * (ket{1}' + ket{4}');
    mu{16} = (1/sqrt(2)) * (ket{1} - 1i*ket{4}) * (1/sqrt(2)) * (ket{1}' + 1i*ket{4}');
end

```

#### 4.子函数:确保最终密度矩阵有物理意义

    function out = makephysical(rho)
    % function out = makephysical(rho)
    % 确保 rho 是正定的密度矩阵。
    % 通过删除负特征值的方式使其正定。
    % 计算矩阵 rho 的特征值分解
    [v, d] = eig(rho);
    
    % 将负特征值设为零
    d(find(d < 0)) = 0;
    
    % 归一化特征值矩阵，使其迹为1
    d = d / trace(d);
    
    % 使用特征向量矩阵 v 和处理后的特征值矩阵 d 重构密度矩阵
    rho = v * d / v;
    
    % 确保密度矩阵是 Hermitian 矩阵并且具有物理意义
    out = tril(rho, -1) + tril(rho, -1)' ...
        + real(diag(diag(rho))) + eye(size(rho)) * 1e-6;
    
    % 详细解释:
    % 1. 特征值分解: [v, d] = eig(rho);
    %    - v 是特征向量矩阵，d 是包含特征值的对角矩阵。
    % 2. 删除负特征值: d(find(d < 0)) = 0;
    %    - 找到 d 中小于零的元素索引，并将这些元素设置为零，确保特征值非负。
    % 3. 归一化特征值矩阵: d = d / trace(d);
    %    - 计算 d 的迹并归一化，使密度矩阵的迹为1。
    % 4. 重构密度矩阵: rho = v * d / v;
    %    - 使用特征向量 v 和处理后的特征值 d 重新构造密度矩阵。
    % 5. 确保 Hermitian 性和数值稳定性:
    %    out = tril(rho, -1) + tril(rho, -1)' + real(diag(diag(rho))) + eye(size(rho)) * 1e-6;
    %    - tril(rho, -1) 提取 rho 的下三角部分（不包括对角线）。
    %    - tril(rho, -1)' 提取 rho 的下三角部分的共轭转置，使 rho 矩阵成为 Hermitian。
    %    - real(diag(diag(rho))) 确保对角元素是实数。
    %    - eye(size(rho)) * 1e-6 在对角线上加入一个非常小的数，确保数值稳定性。
    end
## 2.2 最大似然解法[^1][^7]



极大似然估计（Maximum Likelihood Estimation, MLE）通过最大化测量结果的似然函数来找到最符合实验数据的密度矩阵。这一方法确保找到的密度矩阵在统计意义上最有可能生成观测数据。

### 2.2.1**生成一个物理的密度矩阵**:

定义一个密度矩阵 $\hat{\rho}_p(t)$：
$$
\hat{\rho}_p(t)=\frac{\hat{T}^\dagger(t)\hat{T}(t)}{\mathrm{Tr}\{\hat{T}^\dagger(t)\hat{T}(t)\}}
$$

其中：
- $\hat{T}^\dagger(t)\hat{T}(t)$ 确保厄米性。
- $\frac{1}{\mathrm{Tr}\{\hat{T}^\dagger(t)\hat{T}(t)\}}$ 确保规范性。
- 由于 $\langle\psi|\hat{T}^\dagger\hat{T}|\psi\rangle=\langle\psi^{\prime}|\psi^{\prime}\rangle\geq 0$，正定性也得到了保证。

$\hat{T}(t)$ 的具体形式为：
$$
\hat{T}(t)=\begin{pmatrix}
t_1 & 0 & 0 & 0 \\
t_5 + it_6 & t_2 & 0 & 0 \\
t_{11} + it_{12} & t_7 + it_8 & t_3 & 0 \\
t_{15} + it_{16} & t_{13} + it_{14} & t_9 + it_{10} & t_4
\end{pmatrix}
$$
这个矩阵由16个参数共同确定 $\hat{\rho}_p(t)$​。

 ##### 参数初始值设定

将2.1线性方程组求解出的密度矩阵作为参考,设置初始参数值,有利于更好的进行优化求解

### 2.2.1 引入似然函数:

引入似然函数，量化 $\hat{\rho}_p(t)$ 与实际测量数据之间的关系

对于 $\hat{\rho}_p(t)$ 得到现实测量结果 $[n_1,n_2,\ldots,n_{16}]$ 的概率：
$$
\mathcal{P}(n_1,n_2,\ldots,n_{16})=\frac{1}{N_{\mathrm{norm}}}\prod_{k=1}^{16}\exp\left[-\frac{(n_k-\bar{n}_k)^2}{2\sigma_k^2}\right]
$$

假定为正态分布，其中：
- $\bar{n}_i= \text{Tr}(\rho \mu_i)$
- $\sigma_i^2$ 为方差，可近似看作 $\sigma_i^2=\text{Tr}(\rho \mu_i)$

对其取对数，并去掉不必要的常数可得似然函数：(其中$n_k$为归一化之后的$P_i$值)
$$
\chi^2= \sum_k \frac{(n_k - \hat{n}_k)^2}{2 \hat{n}_k} = \sum_k \frac{(n_k - \text{Tr}[\rho(t) \mu_k])^2}{2 \text{Tr}[\rho(t) \mu_k]}
$$

或者：[^2]
$$
\chi^2=\sum_{i=1}^{16}\left(\frac{C_i^{(M)}-C_i^{(P)}}{\sqrt{C_i^{(M)}+1}}\right)^2=\sum_k^{16} (\frac{n_k - \text{Tr}[\rho(t) \mu_k]}{\sqrt{n_k+1}})^2
$$
其中，$C_i^{(M)}$ 为实际测量值，也就是我们输入的 $P_i$ 转换来的，$C_i^{(P)}$ 为参量矩阵在投影算符 $\mu_i$ 下算出来的理论值。

### 2.2.2 求解最优参数重构密度矩阵

我们通过最小化似然函数来求解最优参数 $t=[t_1,t_2,\ldots,t_{16}]$，以获得最佳重构密度矩阵参数。使用 MATLAB 的 `fmincon` 函数进行优化。

### 2.2.3 最大似然法的缺陷

最大似然估计 (MLE)因为良好地解决了非物理密度矩阵的问题，在量子态层析中被广泛采用。

但最大似然估计同样倾向于产生本征值为零的密度矩阵，即倾向于纯度较高的量子态,与现实中制备的量子态容易受到噪声影响而趋于混态的情况不太相符，在这种情况下极大似然估计很可能会降低量子态层析的精度[^15]。而且，由于量子资源的稀缺性，实验中实际的测量次数一般较少而使得统计误差较大，这时给出含有零本征值的密度矩阵，意味着某种结果不可能出现，如果将该量子态用于预测性的任务这样的论断往往是不合理的。

因此为了应对这种缺陷有关学者提出了约束极大似然估计，通过在似然函数上叠加对密度矩阵的整体约束从而巧妙地避免了本征值为零的结果[^16]。

==最大似然法的缺陷将在量子情况下变得明显，但在经典情况下相对而言影响较小==

### 2.2.4 MATLAB代码示例

#### 1.主函数

```
P4 = [50, 50, 40, 40, 100, 40, 90, 35, 80, 30, 90, 35, 90, 35, 90,35];%理想
% P4 = [52, 47, 34, 34, 76, 48, 75, 47, 52, 23, 88, 26, 81, 32, 78, 21];%7.16
% P4 = [56, 57, 37, 37, 86, 43, 80, 43, 62, 28, 82, 34, 95, 45, 74,37];%7.17
%归一化
    P4d = P4 / sum(P4(1:4));

% 进一步使用最大似然法求解

[rho_final_4d, final_chi2] = reconstruct_density_matrix_4D_MLE(P4d, rho_first_4d);
```

#### 2.子函数:最大似然法优化

```
function [rho_opt, final_chi2] = reconstruct_density_matrix_4D_MLE(P4d, rho_r)
    % 读取测量概率
    p = P4d; % P 应该是一个向量 [p0, p1, p2, ..., p15]

​    % 最大搜索步数
​    max_steps = 1000000;

​    % 设定目标 chi^2 阈值
​    chi2_threshold = 10e-4;

​    % 优化选项
​    options = optimoptions('fmincon', ...
​                           'Display', 'iter', ...
​                           'Algorithm', 'sqp', ...
​                           'MaxIterations', max_steps, ...
​                           'MaxFunctionEvaluations', max_steps, ...
​                           'OptimalityTolerance', 1e-10, ...
​                           'StepTolerance', 1e-10);

​    % 使用初步求解得到的密度矩阵作为初始猜测
​    initial_guess = FindInitialT(rho_r);

​    % 使用 fmincon 进行优化
​    [params, ~] = fmincon(@(params) likelihood_function(params, p, []), ...
​                          initial_guess, [], [], [], [], ...
​                          -inf(16, 1), inf(16, 1), [], options);

​    % 计算最优参数 (t1, t2, ..., t16)
​    t_opt = params;

​    % 重构的密度矩阵
​    rho_opt = construct_density_matrix(t_opt);

​    % 计算最终的 chi^2
​    final_chi2 = likelihood_function(t_opt, p, []);

​    % 检查是否满足条件
​    if final_chi2 < chi2_threshold
​        % 将重构的密度矩阵和最终的 chi^2 存储到工作区
​        assignin('base', 'rho_reconstructed', rho_opt);
​        assignin('base', 'final_chi2', final_chi2);

​        % 显示结果
​        disp('测量值有真实密度矩阵近似对应');
​        disp('Reconstructed density matrix:');
​        disp(rho_opt);
​    else
​        disp('测量值无真实密度矩阵近似对应');
​        disp('Density matrix:');
​        disp(rho_opt);
​    end
end
```

#### 3.子函数:最大似然函数设定

```
function L = likelihood_function(t, p, rho_r)
    % 检查第三个参数是否为空
    if isempty(rho_r)
        % 如果第三个参数为空，则构造密度矩阵
        rho_p = construct_density_matrix(t);
    else
        % 如果第三个参数不为空，则使用提供的密度矩阵
        rho_p = rho_r;
    end

​    % 定义投影算符
​    [~, mu] = define_operators();

​    % 计算理论概率
​    p_theory = zeros(1, 16);
​    for k = 1:16
​        p_theory(k) = real(trace(rho_p * mu{k}));
​    end

​    % 计算似然函数，使用新的定义
​    L = sum((p - p_theory).^2 ./ sqrt(p + 1)); % 计算 chi^2
end
```

#### 4.子函数:优化参数初始值设定

将线性求解得到的密度矩阵作为参数初始值设定参考

```
function outT = FindInitialT(rho)
    outT = zeros(1, 16);
    outT(1) = real(sqrt(det(rho) / minor(rho, 1, 1)));
    temp = minor(rho, 1, 2) / sqrt(minor(rho, 1, 1) * minor(rho, 1:2, 1:2));
    outT(2) = real(temp);
    outT(3) = imag(temp);
    outT(4) = real(sqrt(minor(rho, 1, 1) / minor(rho, 1:2, 1:2)));
    temp = minor(rho, 1:2, 2:3) / sqrt(rho(4, 4)) / sqrt(minor(rho, 1:2, 1:2));
    outT(5) = real(temp);
    outT(6) = imag(temp);
    temp = minor(rho, 1:2, [1 3]) / sqrt(rho(4, 4)) / sqrt(minor(rho, 1:2, 1:2));
    outT(7) = real(temp);
    outT(8) = imag(temp);
    outT(9) = real(sqrt(minor(rho, 1:2, 1:2) / rho(4, 4)));
    temp = rho(4, 1) / sqrt(rho(4, 4));
    outT(10) = real(temp);
    outT(11) = imag(temp);
    temp = rho(4, 2) / sqrt(rho(4, 4));
    outT(12) = real(temp);
    outT(13) = imag(temp);
    temp = rho(4, 3) / sqrt(rho(4, 4));
    outT(14) = real(temp);
    outT(15) = imag(temp);
        outT(16) = real(sqrt(rho(4, 4)));
    end


```

#### 5.子函数:构造 T 矩阵

    function rho_p = construct_density_matrix(t)
        % 构造 T 矩阵
        T = [t(1), 0, 0, 0;
             t(5) + 1i*t(6), t(2), 0, 0;
             t(11) + 1i*t(12), t(7) + 1i*t(8), t(3), 0;
             t(15) + 1i*t(16), t(13) + 1i*t(14), t(9) + 1i*t(10), t(4)];
    
        % 构造物理密度矩阵
        rho_p = (T' * T) / trace(T' * T);
    end
    ```

# 3.分析与结论

量子态层析的目的是通过测量获取目标系统的状态信息，但是如同经典测量一样，估计值与真实值之间或多或少有着一定的差距，这就是量子态层析面临的精度问题。

量子态层析精度的误差包含系统误差和统计误差两个来源[^6][^8]

1. ==系统误差==:

   **是因为在实验测量中仪器的不完美或是操作精度不足等对测量结果产生一定的偏差。**比如离子系统中激光操作的不完美或测量过程中引入的退相千问题等。为了减小系统误差，一般能采取的方法主要是通过选择精度更高的仪器或优化操作方法，比如引入组合脉冲的方式。退相干的问题则是一个更复杂的问题，对此主要是延长相干时间或提高测量速度。其他办法还有通过校准的方式来提高测量装置的精度等。

2. ==统计误差==:

   **由于现实可测量的系统拷贝数目有限，统计误差是不可避免的。因为量子态在每个测量基上的这种概率测量，只能利用频率来近似估计其真实概率。**

   解决方法:

   1.从重构算法上去优化: 合适的重构算法可以提高计算的精度，比如上述极大似然法对线性重构法的优化，其他的算法还有贝叶斯均值估计、约束极大似然法等[^9][^10]。

   2.从测量方式上改善: 不同的测量基所能提取的信息不一样，我们可以通过 Fisher信息量来计算。对于一般性的量子态层析，为了减小平均误差，可以采用一些满足特殊要求的测量基，如互相无偏测量基或对称信总完备测量基[^11][^12]。还有一种很特殊的测量一集体测量，意味着在多拷贝的整体Hilbert空间中选择最优的测量基[^13]。该方法理论上能达到测量极限，但因为需要非局域的测量而在实验中几乎不可能实现。不过另一方面最优测量方式依赖于未知量子态本身，人们因此引入自适应的策略来迭代测量基达到最优的精度[^14]。不同的自适应策略会得到不同的结果，但它们相比于非自适应方案都有着精度的很大提升。

对应于我们的实验,主要误差来源如下

## 3.1 系统误差及其优化

### 3.1.1 投影测量效率带来的系统误差[^3][^4]

假设输入态为
$$
|\psi\rangle =  |0\rangle + |1\rangle +  |2\rangle +  |3\rangle
$$
#### (1) 理想情况

理想输入态的密度矩阵应该如下所示:
$$
\rho_t=\begin{pmatrix}
0.2500 & 0.2500 & 0.2500 & 0.2500 \\
0.2500 & 0.2500 & 0.2500 & 0.2500 \\
0.2500 & 0.2500 & 0.2500 & 0.2500 \\
0.2500 & 0.2500 & 0.2500 & 0.2500
\end{pmatrix}
$$

| ![image-20240718161951681](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240718161951681.png) | ![image-20240718161959907](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240718161959907.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 密度矩阵振幅信息                                             | 密度矩阵相位信息                                             |

理想情况下得到的在16个投影算符$\mu_i$​下测得的功率值之比应当为
$$
P_{th}=\begin{pmatrix}
0.25 & 0.25 & 0.25 & 0.25 & 0.50 & 0.25 & 0.50 & 0.25 & 0.50 & 0.25 & 0.50 & 0.25 & 0.50 & 0.25 & 0.50 & 0.25
\end{pmatrix}
$$

##### 考虑p模式影响后的实验数据上限

由于携带p模式的还原测量效率相较于纯l光效率要低大约20%[^5]，所以考虑到p模式的影响，测量所得理论上可得的最佳功率比值如下
$$
P_{th_p}=\begin{pmatrix}
0.28 & 0.28 & 0.22 & 0.22 & 0.56 & 0.22 & 0.50 & 0.19 & 0.44 & 0.17 & 0.50 & 0.19 & 0.50 & 0.19 & 0.50 & 0.19
\end{pmatrix}
$$
利用此测量功率比值运行上述代码可重构出密度矩阵如下(最大似然):
$$
\rho_e = \begin{pmatrix}
20.2835 & 0.2716 & 0.2350 & 0.2346 \\
30.2716 & 0.2720 & 0.2398 & 0.2354 \\
40.2350 & 0.2398 & 0.2169 & 0.2161 \\
50.2346 & 0.2354 & 0.2161 & 0.2275 
\end{pmatrix} + i \begin{pmatrix}
0.0000 & -0.0364 & -0.0534 & -0.0786 \\
0.0364 & 0.0000 & -0.0259 & -0.0543 \\
0.0534 & 0.0259 & 0.0000 & -0.0306 \\
0.0786 & 0.0543 & 0.0306 & 0.0000 
\end{pmatrix}
$$



| ![image-20240719114341385](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240719114341385.png) | ![image-20240719110214107](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240719110214107.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 密度矩阵振幅信息                                             | 密度矩阵相位信息                                             |

**这说明投影测量效率的不同将在密度矩阵的振幅和相位上带来误差**

计算所得$\chi^2$和保真度如下:

1. **$\chi^2$:最大似然函数的评估系数**
   $$
   \chi^2=\sum_{i=1}^{16}\left(\frac{C_i^{(M)}-C_i^{(P)}}{\sqrt{C_i^{(M)}+1}}\right)^2=\sum_k^{16} (\frac{n_k - \text{Tr}[\rho(t) \mu_k]}{\sqrt{n_k+1}})^2
   $$
   其可以用来评估当前测量功率值是否有真实存在的物理意义上的密度矩阵与之对应,即遍历所有真实存在的物理密度矩阵进行投影测量所得值与实验输入测量功率值的相似程度,$\chi^2$​​值越小就说明越相似,当前测量功率值就越具有现实物理意义.

   $\chi^2$在$10^{-3}$及以下可以视为较可信,在$10^{-3}$​以上这说明通过该测量功率值得出的密度矩阵精度(可信度)较低

   使用上述$P_{th_p}$得到的 $\chi^2$如下

   线性求解 $\chi^2 :3.53430183\times10^{-3}$
   最大似然法 $\chi^2 :2.53566534\times10^{-3}$
   
2. **保真度:用来衡量实验值$\rho_e$与理论值$\rho_t$​​的相似程度**

   保保真度计算公式：
   $$
   F = \left( \text{Tr} \left( \sqrt{ \sqrt{\rho_t} \rho_e \sqrt{\rho_t} } \right) \right)^2
   $$

   其中：

   - \($\sqrt{\rho_t}$\) 表示 \($\rho_t$\) 的矩阵平方根。
   - \($\text{Tr}$\) 表示矩阵的迹。

   线性求解 保真度: 93.7975860 %
   最大似然 保真度: 96.6260710 %

#### (2) 实验情况

##### 现阶段我们所测最优数据(尚未采用标准化)

原始功率值
$$
P_{E1}=\begin{pmatrix}
47 & 47 & 35 & 34 & 75 & 46 & 76 & 48 & 55 & 24 & 86 & 25 & 77 & 18 & 84 & 32
\end{pmatrix}
$$
归一化后:
$$
P_{e1}=\begin{pmatrix}
0.2883 & 0.2883 & 0.2147 & 0.2086 & 0.4601 & 0.2822 & 0.4663 & 0.2945 & 0.3374 & 0.1472 & 0.5276 & 0.1534 & 0.4724 & 0.1104 & 0.5153 & 0.1963
\end{pmatrix}
$$
计算可得
$$
\rho_{e1}=\begin{pmatrix}
0.2987 & 0.1913 & 0.2159 & 0.2023 \\
0.1913 & 0.2771 & 0.1909 & 0.1921 \\
0.2159 & 0.1909 & 0.2127 & 0.1478 \\
0.2023 & 0.1921 & 0.1478 & 0.2115
\end{pmatrix}
+ i \begin{pmatrix}
0.0000 & -0.0118 & -0.0638 & -0.0641 \\
0.0118 & 0.0000 & 0.0319 & -0.1090 \\
0.0638 & -0.0319 & 0.0000 & -0.0528 \\
0.0641 & 0.1090 & 0.0528 & 0.0000
\end{pmatrix}
$$

| ![image-20240719114204998](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240719114204998.png) | ![image-20240719114110806](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240719114110806.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 密度矩阵振幅信息                                             | 密度矩阵相位信息                                             |

计算所得$\chi^2$和保真度如下:

1. **$\chi^2$:最大似然函数的评估系数**

   线性求解 $\chi^2$:1.28531421e-02
   最大似然法$\chi^2$:1.04971234e-02

2. **保真度:用来衡量实验值$\rho_e$与理论值$\rho_t$​​的相似程度**

   线性求解 保真度: 78.4345920 %
   最大似然 保真度: 82.0150900 %

##### 现阶段我们所测最优数据(采用标准化后)

$$
P_{E2}=\begin{pmatrix}
55 & 55 & 52 & 52 & 88 & 52 & 101 & 65 & 85 & 37 & 110 & 33 & 111 & 43 & 100 & 25
\end{pmatrix}
$$

归一化后:
$$
P_{e2}=\begin{pmatrix}
0.257 & 0.257 & 0.243 & 0.243 & 0.411 & 0.243 & 0.472 & 0.304 & 0.397 & 0.173 & 0.514 & 0.154 & 0.519 & 0.201 & 0.467 & 0.117
\end{pmatrix}
$$
计算可得:
$$
\rho_{e2}=\begin{pmatrix}
0.2593 & 0.1718 & 0.2258 & 0.1852 \\
0.1718 & 0.2713 & 0.1878 & 0.2333 \\
0.2258 & 0.1878 & 0.2371 & 0.1989 \\
0.1852 & 0.2333 & 0.1989 & 0.2323
\end{pmatrix}
+ i \begin{pmatrix}
0.0000 & -0.0489 & -0.0750 & -0.1029 \\
0.0489 & 0.0001 & 0.0397 & -0.0551 \\
0.0750 & -0.0397 & 0.0000 & -0.0683 \\
0.1029 & 0.0551 & 0.0683 & 0.0000
\end{pmatrix}
$$


| ![image-20240723170623981](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240723170623981.png) | ![image-20240723170550202](D:\BaiduNetdiskWorkspace\研究生\研究生文献\方向5量子层析\量子层析基础使用手册.assets\image-20240723170550202.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 密度矩阵振幅信息                                             | 密度矩阵相位信息                                             |

计算所得$\chi^2$和保真度如下:

1. **$\chi^2$: 最大似然函数的评估系数**

   线性求解 $\chi^2$: 1.06939696e-02  
   最大似然法 $\chi^2$: 7.80757458e-03

2. **保真度: 用来衡量实验值 $\rho_e$ 与理论值 $\rho_t$ 的相似程度**

   线性求解 保真度: 79.5805160 %  
   最大似然 保真度: 85.1390510 %

#### (3) 结论

由于整个量子层析过程我们仅仅依据的是测量功率值的**归一化值**即:
$$
\quad \vec{P} = \begin{pmatrix}
P_1 \\
P_2 \\
\vdots \\
P_{16}
\end{pmatrix}/\sum^4_1(P_i)
$$
作为数据输入.

所以只要测量时制备的态在各个投影算符$\mu_i$上的测量收集效率**相同**,那么就不会产生**投影测量效率误差**

如果无法将各个投影算符$\mu_i$​上的测量收集效率调到一致,那么只能通过其他**数据处理的特殊方法**来尝试将**投影测量效率误差**减小

### 3.1.2 SLM相关因素带来的系统误差

现阶段考虑到的可能影响因素有:1.相位图像素限制;2.入射slm初始角度带来的误差;3.分屏模式下slm对入射光的调制能力下降带来的误差;4.反射型slm只能用相位调制模拟p模式的振幅调制带来的误差...

## 3.2 统计误差及其优化

在经典光下，量子层析的统计误差带来的影响将明显弱于系统误差，因此现阶段我们将更多关注于系统误差的优化。

# 4.代码包使用指南

首先打开theoretical_measurement_powers_4D或者2D，点击运行输入理论密度矩阵参数

打开main主函数

二维情况在%%2D下对应P2输入实际测量功率值

四维情况在%%4D下对应P4输入实际测量功率值

点击运行即可

# 参考文献

[^1]:  D. F. V. James, P. G. Kwiat, W. J. Munro, and A. G. White, "Measurement of qubits," *Physical Review A*, vol. 64, no. 5, p. 052312, 2001. [Online]. Available: http://doi.org/10.1103/PhysRevA.64.052312

[^2]:1. B. Jack, J. Leach, H. Ritsch, S. M. Barnett, and M. J. Padgett, "Precise quantum tomography of photon pairs with entangled orbital angular momentum," *New Journal of Physics*, vol. 11, no. 10, p. 103024, 2009. [Online]. Available: http://doi.org/10.1088/1367-2630/11/10/103024
[^3]:F. S. Roux and Y. Zhang, "Projective measurements in quantum and classical optical systems," *Physical Review A*, vol. 90, no. 3, p. 033835, 2014. [Online]. Available: http://doi.org/10.1103/PhysRevA.90.033835
[^4]: H. Qassim, F. M. Miatto, J. P. Torres, M. J. Padgett, E. Karimi, and R. W. Boyd, "Limitations to the determination of a Laguerre–Gauss spectrum via projective, phase-flattening measurement," *Journal of the Optical Society of America B*, vol. 31, no. 6, pp. A20-A23, 2014. [Online]. Available: http://doi.org/10.1364/JOSAB.31.000A20
[^5]: M. Mazelanik, M. Parniak, and W. Wasilewski, "Measuring azimuthal and radial modes of photons," *Optics Express*, vol. 26, no. 24, pp. 31925-31937, 2018. [Online]. Available: http://doi.org/10.1364/OE.26.031925
[^6]:殷琪.量子层析技术的理论及其光学实验研究[D].中国科学技术大学,2018.
[^7]:  K. Banaszek, G. M. D'Ariano, M. G. A. Paris, and M. F. Sacchi, "Maximum-likelihood estimation of the density matrix," *Physical Review A*, vol. 61, no. 1, p. 010304, 1999. [Online]. Available: http://doi.org/10.1103/PhysRevA.61.010304
[^8]: N. K. Langford, "Errors in quantum tomography: diagnosing systematic versus statistical errors," *New Journal of Physics*, vol. 15, no. 3, p. 035003, 2013. [Online]. Available: http://doi.org/10.1088/1367-2630/15/3/035003

[^9]: R. Blume-Kohout, "Optimal, reliable estimation of quantum states," *New Journal of Physics*, vol. 12, no. 4, p. 043034, 2010. [Online]. Available: http://doi.org/10.1088/1367-2630/12/4/043034
[^10]:R. Blume-Kohout, "Hedged Maximum Likelihood Quantum State Estimation," *Physical Review Letters*, vol. 105, no. 20, p. 200504, 2010. [Online]. Available: http://doi.org/10.1103/PhysRevLett.105.200504
[^11]: R. B. A. Adamson and A. M. Steinberg, "Improving Quantum State Estimation with Mutually Unbiased Bases," *Physical Review Letters*, vol. 105, no. 3, p. 030406, 2010. [Online]. Available: http://doi.org/10.
[^12]:H. J. Zhu and M. Hayashi, "Universally Fisher-Symmetric Informationally Complete Measurements," *Physical Review Letters*, vol. 120, no. 3, p. 030404, 2018. [Online]. Available: http://doi.org/10.1103/PhysRevLett.120.030404
[^13]: S. Massar and S. Popescu, "Optimal Extraction of Information from Finite Quantum Ensembles," *Physical Review Letters*, vol. 74, no. 8, p. 1259, 1995. [Online]. Available: http://doi.org/10.1103/PhysRevLett.74.1259
[^14]: F. Huszár and N. M. T. Houlsby, "Adaptive Bayesian quantum tomography," *Physical Review A*, vol. 85, no. 5, p. 052120, 2012. [Online]. Available: http://doi.org/10.1103/PhysRevA.85.052120
[^15]: R. Blume-Kohout, "Optimal, reliable estimation of quantum states," *New Journal of Physics*, vol. 12, no. 4, p. 043034, 2010. [Online]. Available: http://doi.org/10.1088/1367-2630/12/4/043034
[^16]: R. Blume-Kohout, "Hedged Maximum Likelihood Quantum State Estimation," XZZ*Physical Review Letters*, vol. 105, no. 20, p. 200504, 2010. [Online]. Available: http://doi.org/10.1103/PhysRevLett.105.200504
